!function(n,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.AGLJS=t():n.AGLJS=t()}(window,function(){return o={},i.m=e=[function(n,t){AFB=function(n,t){"object"!=typeof n&&(n={base:n,token:t});function e(n,t){this.token=n,this.uuid=t}var u,o,i={base:n.base||"api",token:n.token||t||"HELLO",host:n.host||window.location.host,url:n.url||void 0},r=i.url||"ws://"+i.host+"/"+i.base,s=void 0,c=i.token;e.prototype={get token(){return c},set token(n){n&&(c=n)},get uuid(){return s},set uuid(n){n&&(s=n)}},u=new e;function a(n,t,e,o){if(t in n){var i=n[t];delete n[t];try{i[o](e)}catch(n){}}}return(o=function(n,t){var e=r,o="?";u.token&&(e=e+"?x-afb-token="+u.token,o="&"),u.uuid&&(e=e+o+"x-afb-uuid="+u.uuid),this.ws=new WebSocket(e,["x-afb-ws-json1"]),this.url=e,this.pendings={},this.awaitens={},this.counter=0,this.ws.onopen=function(n){var t=this.onopen;delete this.onopen,delete this.onabort,t&&t(this)}.bind(this),this.ws.onerror=function(n){var t=this.onabort;t&&(delete this.onopen,delete this.onabort,t&&t(this));this.onerror&&this.onerror(this)}.bind(this),this.ws.onclose=function(n){var t={jtype:"afb-reply",request:{status:"disconnected",info:"server hung up"}};for(var e in this.pendings)try{this.pendings[e][1](t)}catch(n){}this.pendings={},this.onclose&&this.onclose()}.bind(this),this.ws.onmessage=function(n){var t=JSON.parse(n.data),e=t[0],o=t[1],i=t[2];switch(u.token=t[3],e){case 3:a(this.pendings,o,i,0);break;case 4:a(this.pendings,o,i,1);break;case 5:default:!function(n,t,e){var o=n[t];o&&o.forEach(function(n){n(e)});var i=t.indexOf("/");0<=i&&(o=n[t.substring(0,i)])&&o.forEach(function(n){n(e)});(o=n["*"])&&o.forEach(function(n){n(e)})}(this.awaitens,o,i)}}.bind(this),this.onopen=n,this.onabort=t}).prototype={close:function(){this.ws.close(),this.ws.onopen=this.ws.onerror=this.ws.onclose=this.ws.onmessage=this.onopen=this.onabort=function(){}},call:function(i,r,s){return new Promise(function(n,t){var e,o;if(s){if((e=String(s))in this.pendings)throw new Error("pending callid("+e+") exists")}else for(;(e=String(this.counter=4095&this.counter+1))in this.pendings;);this.pendings[e]=[n,t],o=[2,e,i,r],u.token&&o.push(u.token),this.ws.send(JSON.stringify(o))}.bind(this))},onevent:function(n,t){var e=n;(this.awaitens[e]||(this.awaitens[e]=[])).push(t)}},{context:u,ws:o}}},function(n,t,e){"use strict";e.r(t);var o={};e.r(o),e.d(o,"call",function(){return c}),e.d(o,"subscribe",function(){return a}),e.d(o,"init",function(){return f});var i={};e.r(i),e.d(i,"list_controls",function(){return d}),e.d(i,"set_volume",function(){return h}),e.d(i,"on_volume_changed",function(){return l}),e.d(i,"on_controls_changed",function(){return p});e(0),document.location.hostname,document.location.port;var u,r=new URLSearchParams(document.location.search.substring(1)),s=r.get("x-afb-token")||r.get("token")||"HELLO";function c(o,i){return new Promise(function(t,e){var n=new u.ws(function(){n.call(o,i).then(function(n){t(n.response)},function(n){e(n)})},function(){e("ws aborted")})})}function a(i,r,s){return new Promise(function(e,t){var o=new u.ws(function(){o.call(i,{event:r}).then(function(n){var t=i.split("/")[0]+"/"+r;o.onevent(t,function(n){s(n.data)}),e()},function(n){t(n)})},function(){t("ws aborted")})})}function f(){u=new AFB({host:"192.168.1.102:31022",token:s})}function d(){return c("audiomixer/list_controls",{})}function h(n,t){return c("audiomixer/volume",{control:n,value:t})}function l(n){return a("audiomixer/subscribe","volume_changed",n)}function p(n){return a("audiomixer/subscribe","controls_changed",n)}e.d(t,"audiomixer",function(){return i}),e.d(t,"api",function(){return o}),f()}],i.c=o,i.d=function(n,t,e){i.o(n,t)||Object.defineProperty(n,t,{enumerable:!0,get:e})},i.r=function(n){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},i.t=function(t,n){if(1&n&&(t=i(t)),8&n)return t;if(4&n&&"object"==typeof t&&t&&t.__esModule)return t;var e=Object.create(null);if(i.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var o in t)i.d(e,o,function(n){return t[n]}.bind(null,o));return e},i.n=function(n){var t=n&&n.__esModule?function(){return n.default}:function(){return n};return i.d(t,"a",t),t},i.o=function(n,t){return Object.prototype.hasOwnProperty.call(n,t)},i.p="",i(i.s=1);function i(n){if(o[n])return o[n].exports;var t=o[n]={i:n,l:!1,exports:{}};return e[n].call(t.exports,t,t.exports,i),t.l=!0,t.exports}var e,o});